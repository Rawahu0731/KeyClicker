# Text Recognition Macro System

画面の指定領域の文字を読み取り、一致した場合にマクロを実行するPythonシステムです。

## 機能

- **画面領域選択**: マウスドラッグで監視したい領域を直感的に選択
- **文字認識**: OCR（Tesseract）を使用した高精度な文字認識
- **多様なマクロアクション**: クリック、キーボード入力、文字入力、待機など
- **リアルタイム監視**: 指定した間隔で自動的に領域をチェック
- **GUI操作**: 使いやすいtkinterベースのインターフェース
- **設定保存**: JSON形式での設定の保存・読み込み

## セットアップ

### 1. 必要なライブラリのインストール

```powershell
pip install -r requirements.txt
```

### 2. Tesseract OCRエンジンのインストール

#### Windows:
1. [Tesseract installer](https://github.com/UB-Mannheim/tesseract/wiki)からダウンロード
2. インストール後、`text_macro_gui.py`の以下の行のコメントを外してパスを設定:

```python
pytesseract.pytesseract.tesseract_cmd = r'C:\Program Files\Tesseract-OCR\tesseract.exe'
```

#### 日本語認識を使う場合:
日本語データをダウンロードして追加インストールが必要です。

## 使用方法

### 1. GUIアプリケーションの起動

```powershell
python text_macro_gui.py
```

### 2. 監視領域の設定

1. **「領域選択」ボタンをクリック**
2. **画面全体が表示されるので、マウスでドラッグして監視したい領域を選択**
3. **設定ダイアログで以下を入力:**
   - 名前: 領域の識別名
   - 検索文字: 検出したい文字
   - アクション: 文字が一致した時に実行する動作

### 3. アクションの種類

- **click**: 指定座標をクリック
- **key**: 特定のキーを押す（例: space, enter, ctrl）
- **type**: テキストを入力
- **wait**: 指定秒数待機
- **move**: マウスカーソルを移動
- **hotkey**: ショートカットキー（例: Ctrl+C）

### 4. 監視の開始

1. **チェック間隔を設定**（デフォルト: 1秒）
2. **「監視開始」ボタンをクリック**
3. **システムが自動的に領域をチェックし、文字が一致したらアクションを実行**

## 設定例

```json
{
  "monitoring_regions": [
    {
      "name": "start_button",
      "x": 100,
      "y": 100,
      "width": 200,
      "height": 50,
      "target_text": "開始",
      "actions": [
        {
          "type": "click",
          "x": 500,
          "y": 300
        },
        {
          "type": "wait",
          "duration": 1
        },
        {
          "type": "key",
          "key": "space"
        }
      ]
    }
  ],
  "check_interval": 1.0,
  "ocr_language": "jpn+eng"
}
```

## ファイル構成

- `text_macro_gui.py`: メインのGUIアプリケーション
- `text_macro.py`: コマンドライン版（オプション）
- `config_tool.py`: 設定ツール（オプション）
- `config.json`: 設定ファイル（自動生成）
- `requirements.txt`: 必要なライブラリリスト

## 注意事項

- **pyautogui.FAILSAFE**: 安全機能として、マウスカーソルを画面の左上角に移動させると自動停止します
- **管理者権限**: 一部のアプリケーションでは管理者権限が必要な場合があります
- **OCR精度**: 文字の大きさや背景によって認識精度が変わります
- **実行間隔**: あまり短い間隔に設定するとCPU使用率が高くなります

## トラブルシューティング

### 文字認識がうまくいかない場合:
1. 監視領域を文字が見やすい部分に調整
2. OCR言語設定を確認（日本語: jpn、英語: eng）
3. 文字のサイズや背景のコントラストを確認

### アクションが実行されない場合:
1. 座標が正しいか確認
2. 対象アプリケーションがアクティブか確認
3. セキュリティソフトウェアの影響を確認

### その他の問題:
ログウィンドウでエラーメッセージを確認してください。